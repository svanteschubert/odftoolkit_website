<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
  <!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

  <link href="/odftoolkit_website/css/odf.css" rel="stylesheet" type="text/css">
  
  <title></title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28945571-1']);
    _gaq.push(['_trackPageview']);

    (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
</head>

<body>

  <div id="banner">
    <!--
    <div id="bannerright"><a alt="Apache Incubator" href="http://incubator.apache.org">
      <img id="asf-logo" alt="Apache Incubator" src="/odftoolkit_website/images/apache-incubator-logo.png"/></a></div>
    <div id="bannercenter"><br/>&nbsp;&nbsp;&nbsp;&nbsp;Apache ODF Toolkit (incubating)</div>
    -->
    <div id="bannerright"><a alt="The Document Foundation" href="https://www.documentfoundation.org/">
        <img id="tdf-logo" class="w350" alt="The Document Foundation"
          src="/odftoolkit_website/images/LibreOffice-Initial-Artwork-Logo-ColorLogoBasic-500px.png" /></a></div>
  </div>
  <div id="clear"></div>
  
  <div id="sidenav">
    <style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }</style>
<h1 id="general">General<a class="headerlink" href="#general" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="/odftoolkit_website/index.html">About</a></li>
<li><a href="/odftoolkit_website/downloads.html">Downloads</a></li>
<li><a href="/odftoolkit_website/license.html">License</a></li>
<li><a href="/odftoolkit_website/privacy.html">Privacy Policy</a></li>
</ul>
<h1 id="components">Components<a class="headerlink" href="#components" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="/odftoolkit_website/odfdom/index.html">ODFDOM</a></li>
<li><a href="/odftoolkit_website/simple/index.html">Simple API (deprecated)</a></li>
<li><a href="/odftoolkit_website/conformance/ODFValidator.html">ODF Validator</a></li>
<li><a href="/odftoolkit_website/xsltrunner/ODFXSLTRunner.html">XSLT Runner</a></li>
</ul>
<h1 id="community">Community<a class="headerlink" href="#community" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="/odftoolkit_website/get-involved.html">Get Involved</a></li>
<li><a href="/odftoolkit_website/mailing-lists.html">Mailing Lists</a></li>
<li><a href="/odftoolkit_website/people.html">People</a></li>
<li><a href="/odftoolkit_website/community-faqs.html">Community FAQs</a></li>
</ul>
<h1 id="development">Development<a class="headerlink" href="#development" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="/odftoolkit_website/source.html">Source Code</a></li>
<li><a href="https://github.com/tdf/odftoolkit/issues">Bug Tracker</a></li>
<li><a href="/odftoolkit_website/javadoc/0.9.0-SNAPSHOT/" target="_blank">JavaDoc</a></li>
<li><a href="/odftoolkit_website/website-local.html">Website</a></li>
<li><a href="/odftoolkit_website/developer-faqs.html">Developer FAQs</a></li>
</ul>
<h1 id="tdf">TDF<a class="headerlink" href="#tdf" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="https://www.documentfoundation.org/">The Document Foundation</a></li>
<li><a href="https://www.documentfoundation.org/">Become a Sponsor</a></li>
</ul>
  </div>
  <div id="contenta">
    
      
      <style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }</style>
<p><strong><a href="index.html">Demos</a></strong> &gt; <strong>Navigation API in Hotel Receipt</strong>     </p>
<p><strong>Overview</strong>    </p>
<p>This demo is a simple template application about hotel receipt. By loading the configuration file "consume-data.properties" and navigating the hotel receipt template, this demo could generate the ODF documents (ODT, ODP, and ODS format).    </p>
<p>In the generated ODF documents, you can see the concrete information about hotel receipt, such as hotel name, customer name, consume time, consume data, total expense, headcount, and consume item details including the price, quantity, total expense of each item. Taking the ODT document as an example, the ODT document template is shown in the following picture. Please notice the area surrounding by eight small green square, it is a chart. Because this chart is generated by the column ConsumeItem and the column Total Expense($) in the above table and the values of the column Total Expense($) are not numeric type, the template chart might not display correctly in your ODF editor, but it will display correctly after the template is expanded.   </p>
<p><img src="image/ODT Templating.jpg" ></img>  </p>
<p>And the generated ODT document is shown in the following picture.   </p>
<p><img src="image/Generated ODT.jpg" ></img></p>
<p>Use Simple API to complete this simple template application. This demo mainly uses the API of package navigation.    </p>
<p>In the root directory of this demo project, there are three defined ODF template documents, "Navigation-ODT-Templating.odt", "Navigation-ODP-Templating.odp" and "Navigation-ODS-Templating.ods", and one configuration file, "consume-data.properties". Run NavigationForODF.java, and then in the root directory of this demo project you can find three generated ODF documents, "Navigation-ODT-Generated.odt", "Navigation-ODP-Generated.odp" and "Navigation-ODS-Generated.ods", which contain the information of "consume-data.properties". In these ODF documents, the consume item details are shown as table and chart.    </p>
<p>Please notice the differences of ODT, ODP, ODS template document. In ODT and ODS template documents, the chart could be automatically generated by the ODF editor according to the data of table, and in this demo the data of chart comes from the column of ConsumeItem and Total Expense($). But in ODP template documents, the chart can not be automatically generated by the table, in fact, the chart in ODP template document is created manually through the function "insert chart" of openoffice, and the type of second column must be numeric. In addition, please notice the cell value of ODS document, the cell value has character type and numeric type, for example, ‘5,000 represents character type and 5,000 represents numeric type, and we could see that the different point is the single quotation marks before 5,000.   </p>
<p><strong>Code Introduction</strong></p>
<p>First, load the key-value in the file "consume-data.properties" into the instance of Properties, and put ConsumeItem as key and TotalExpenseOfItem as value to the instance of HashMap for navigating ODP document template.   </p>
<div class="codehilite"><pre><span></span>public void loadConsumeData(String filepath) throws Exception {
    InputStream is = new FileInputStream(filepath);
    properties.load(is);
    is.close();
    // put ConsumeItem as key and TotalExpenseOfItem as value to map
    Enumeration&lt;String&gt; enu = (Enumeration&lt;String&gt;) properties.propertyNames();
    while (enu.hasMoreElements()) {
        String key = (String) enu.nextElement();
        if (key.contains(&quot;ConsumeItem&quot;)) {
            String consumeItem = properties.getProperty(key);
            String totalExpenseOfItem = properties.getProperty(&quot;TotalExpenseOfItem&quot;
                                        + key.charAt(key.length() - 1));
            map.put(consumeItem, totalExpenseOfItem);
        }
    }
}
</pre></div>


<p>Then, introduce how to navigate the template documents and generate the ODF documents.    </p>
<p><strong><em>Navigate ODT document template</em></strong>  </p>
<p>Load "Navigation-ODT-Templating.odt" and get the instance of TextDocument. Then traverse the instance of Properties, use the API of TextNavigation and TextSelection to complete the replacement of template document as the line 10-14. Please notice the line 17 and 18, make sure that the chart is shown rightly when open the generated document, so is navigating ODP and ODS document template. At last, generate "Navigation-ODT-Generated.odt" as the line 19.    </p>
<div class="codehilite"><pre><span></span><span class="nt">public</span> <span class="nt">void</span> <span class="nt">navigateODT</span><span class="o">()</span> <span class="nt">throws</span> <span class="nt">Exception</span> <span class="p">{</span>
    <span class="err">Iterator</span> <span class="err">it</span> <span class="err">=</span> <span class="err">properties.entrySet().iterator()</span><span class="p">;</span>
    <span class="err">System.out.println(&quot;Navigate</span> <span class="err">ODT</span> <span class="n">document</span><span class="p">:</span> <span class="n">Navigation-ODT-Templating</span><span class="o">.</span><span class="n">odt</span><span class="s2">&quot;);</span>
<span class="s2">    TextDocument textdoc = (TextDocument) TextDocument.loadDocument(&quot;</span><span class="n">Navigation-ODT-Templating</span><span class="o">.</span><span class="n">odt</span><span class="s2">&quot;);</span>
<span class="s2">    TextNavigation search;</span>
<span class="s2">    while (it.hasNext()) {</span>
<span class="s2">        Map.Entry entry = (Map.Entry) it.next();</span>
<span class="s2">        String key = (String) entry.getKey();</span>
<span class="s2">        String value = (String) entry.getValue();</span>
<span class="s2">        search = new TextNavigation(key, textdoc);</span>
<span class="s2">        while (search.hasNext()) {</span>
<span class="s2">            TextSelection item = (TextSelection) search.nextSelection();</span>
<span class="s2">            item.replaceWith(value);</span>
<span class="s2">        }</span>
<span class="s2">    }</span>
<span class="s2">    // remove ObjectReplacements/ and Thumbnails/</span>
<span class="s2">    textdoc.getPackage().removePackageDocument(&quot;</span><span class="n">ObjectReplacements</span><span class="o">/</span><span class="s2">&quot;);</span>
<span class="s2">    textdoc.getPackage().removePackageDocument(&quot;</span><span class="n">Thumbnails</span><span class="o">/</span><span class="s2">&quot;);</span>
<span class="s2">    textdoc.save(&quot;</span><span class="n">Navigation-ODT-Generated</span><span class="o">.</span><span class="n">odt</span><span class="s2">&quot;);</span>
<span class="s2">    System.out.println(&quot;</span><span class="o">...</span><span class="err">\</span><span class="n">nNavigation</span> <span class="n">is</span> <span class="kc">over</span><span class="p">,</span> <span class="n">and</span> <span class="n">Navigation-ODT-Generated</span><span class="o">.</span><span class="n">odt</span> <span class="n">is</span> <span class="n">generated</span><span class="err">&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p><strong><em>Navigate ODP document template</em></strong>   </p>
<p>Unlike the ODT document, the chart of ODP document is an embedded document. Before navigate the chart, get the embedded document as the line 2 and 3. The chart comes from a table, and we could change the chart by setting the cell value of the table as the line 13-15. The line 15 uses the Class DefaultCellValueAdapter to update the cell value and value type.    </p>
<div class="codehilite"><pre><span></span>    // set the cell value in the table of embedderdocument
    List&lt;Document&gt; embeddedDocuments = pdoc.getEmbeddedDocuments();
    Document embeddedDocument = embeddedDocuments.get(0);
    Table table = embeddedDocument.getTableList().get(0);
    String consumeItem;
    String totalExpenseOfItem;
    int index = 0;
    Iterator&lt;String&gt; it = map.keySet().iterator();
    while (it.hasNext()) {
        index++;
        consumeItem = (String) it.next();
        totalExpenseOfItem = (String) map.get(consumeItem);
        table.getColumnByIndex(0).getCellByIndex(index).setDisplayText(consumeItem);
        table.getColumnByIndex(1).getCellByIndex(index).setDisplayText(totalExpenseOfItem, new DefaultCellValueAdapter());
    }
</pre></div>


<p><strong><em>Navigate ODS document template</em></strong>   </p>
<p>Unlike the ODT document, use the Class CellSelection to complete the replacement. Class CellSelection is the subclass of Class TextSelection. Use the method "advancedReplaceWith" to update the cell value and value type.    </p>
<div class="codehilite"><pre><span></span>    search = new TextNavigation(key, ssdoc);
    while (search.hasNext()) {
        CellSelection item = (CellSelection) search.nextSelection();
        item.advancedReplaceWith(value, new DefaultCellValueAdapter());
    }
</pre></div>


<p><strong>Download</strong>   </p>
<p>Powered by Simple API version <a href="../downloads.html">0.3.5</a>.<br />
You can download the code of this demo from <a href="Navigation-for-ODF.zip">here</a>.  </p>
    </div>
    
    <div id="footera">
      <div id="copyrighta">
        <p><a href="https://www.libreoffice.org/imprint" target="_blank">Impressum (Legal Info)</a> | <a
            href="https://www.libreoffice.org/privacy" target="_blank">Privacy Policy (Datenschutzerklärung)</a> | <a
            href="https://www.documentfoundation.org/statutes.pdf" target="_blank">Statutes (non-binding English
            translation)</a> - <a href="https://www.documentfoundation.org/satzung.pdf" target="_blank">Satzung (binding
            German version)</a> | Copyright information: Unless otherwise specified, all text and images on this website
          are licensed under the <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank">Creative
            Commons Attribution-Share Alike 3.0 License</a>. This does not include the source code of LibreOffice, which
          is licensed under the <a href="https://www.libreoffice.org/download/license/" target="_blank">Mozilla Public
            License v2.0</a>. “LibreOffice” and “The Document Foundation” are registered trademarks of their
          corresponding registered owners or are in actual use as trademarks in one or more countries. Their respective
          logos and icons are also subject to international copyright laws. Use thereof is explained in our <a
            href="https://wiki.documentfoundation.org/TradeMark_Policy" target="_blank">trademark policy</a>.
          LibreOffice was based on OpenOffice.org.</p>
      </div>
    </div>   
  </div>
</body>

</html>